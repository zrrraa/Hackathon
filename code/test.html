<!DOCTYPE html>
<html>
<head>
    <title>{lake_name}</title>
    <style>
        /* 添加按钮样式 */
        body {
            font-family: "Microsoft YaHei", Arial, sans-serif;
            color: black; /* 设置字体颜色为黑色 */
        }
        /* 添加展开/折叠按钮样式 */
        .toggle-button {
            background-color: #f1f1f1;
            color: #333;
            cursor: pointer;
            padding: 5px;
            border: none;
            width: 100%;
            text-align: left;
            outline: none;
            font-weight: bold;
        }
        .toggle-content {
            display: none;
            padding: 5px;
        }
        .toggle-content.open {
            display: block;
        }
    </style>
    <script>
        // JavaScript function to toggle the content
        function toggleContent() {
            var content = document.getElementById("input-content");
            content.classList.toggle("open");
        }

        // JavaScript function to calculate the value
        function calculateValue() {
            var year1 = parseFloat(document.getElementById("year1").value);
            var biomass1 = parseFloat(document.getElementById("biomass1").value);
            var biomass2 = parseFloat(document.getElementById("biomass2").value);
            var stateMessage = "";
            var state = calculate_fishstate(year1, biomass1, biomass2);

            if (state === 0) {
                stateMessage = "当前状态：可捕捞";
            } else if (state !== null) {
                stateMessage = "当前状态：" + state + "年后可捕捞";
            } else {
                stateMessage = "当前状态：禁渔中";
            }
            // 更新状态信息
            document.getElementById("output-value").innerHTML = stateMessage;
        }

        function calculate_fishstate(year, biomass1, biomass2) {
            // 计算
            var growth = biomass2 - biomass1;
            var intrinsic_growth_rate = 0.53;
            var biomass_v = biomass1;
            var K = intrinsic_growth_rate * Math.pow(biomass_v, 2) / (intrinsic_growth_rate * biomass_v - growth);
            var biomass0 = biomass1;

            if (biomass2 >= K / 2) {
                return 0; // 若可捕捞返回0
            }

            var result = transcendental_equation(K, biomass0, intrinsic_growth_rate);
            if (result !== null) {
                return year + result - 2023; // 若不可捕捞返回预计几年后可以捕捞
            }
        }

        function transcendental_equation(K, biomass0, intrinsic_growth_rate) {
            // 定义函数表达式
            function equation(t) {
                return K / (Math.exp(Math.log(K / biomass0 - 1) - intrinsic_growth_rate * t) + 1) - K / 2;
            }

            // 定义函数的导数
            function derivative(t) {
                return K * intrinsic_growth_rate * Math.exp(Math.log(K / biomass0 - 1) - intrinsic_growth_rate * t) / ((Math.exp(Math.log(K / biomass0 - 1) - intrinsic_growth_rate * t) + 1) ** 2);
            }

            // 初始化变量
            var t = 1.0; // 初始猜测值
            var epsilon = 1e-6; // 精度要求
            var max_iterations = 1000; // 最大迭代次数

            // 牛顿迭代法
            for (var i = 0; i < max_iterations; i++) {
                var f = equation(t);
                var f_prime = derivative(t);
                var delta_t = f / f_prime;
                t -= delta_t;
                if (Math.abs(delta_t) < epsilon) {
                    return t; // 返回多少年后生物量达到K/2
                }
            }

            // 如果超过最大迭代次数仍未找到解，则返回null
            return null;
        }
    </script>
</head>
<body>
    <h1>{lake_name}</h1>
    <p>经度：{lon}度</p>
    <p>纬度：{lat}度</p>
    <p>面积：{area}平方公里</p>
    <p>容量：{capacity}</p>
    <p>气候：{climate}</p>
    
    <button class="toggle-button" onclick="toggleContent()">更新数据</button>
    <div id="input-content" class="toggle-content">
        <form id="input-form">
            <label for="year1">数据测量时间（第一年）：</label>
            <input type="text" id="year1" name="year1" required><br><br>
            <label for="biomass1">第一年生物量：</label>
            <input type="text" id="biomass1" name="biomass1" required><br><br>
            <label for="biomass2">第二年生物量：</label>
            <input type="text" id="biomass2" name="biomass2" required><br><br>
            <input type="button" value="计算" onclick="calculateValue()">
        </form>
    </div>
    
    <div id="output-value"></div>
</body>
</html>
